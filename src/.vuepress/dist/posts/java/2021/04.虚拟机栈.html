<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://falser101.github.io/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html"><meta property="og:site_name" content="飞哥与小佛"><meta property="og:title" content="虚拟机栈"><meta property="og:description" content="虚拟机栈概述 虚拟机栈概述 虚拟机出现的背景 由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。 优点：跨平台，指令集小，编译器容易实现 缺点：性能下降，实现同样的功能需要更多的指令。 基本内容 Java虚拟机栈是什么? Java虚拟机栈(Java Virtual Machine Stack) ，早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧(Stack Frame) ，对应着一次次的Java方法调用。 是线程私有的 生命周期： 生命周期和线程一致。 作用： 主管Java程序的运行，它保存方法的局部变量、部分结果，并参与方法的调用和返回。"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-11-22T06:14:41.000Z"><meta property="article:author" content="falser"><meta property="article:tag" content="jvm"><meta property="article:published_time" content="2021-02-12T00:00:00.000Z"><meta property="article:modified_time" content="2023-11-22T06:14:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"虚拟机栈","image":[""],"datePublished":"2021-02-12T00:00:00.000Z","dateModified":"2023-11-22T06:14:41.000Z","author":[{"@type":"Person","name":"falser","url":"https://github.com/falser101"}]}</script><title>虚拟机栈 | 飞哥与小佛</title><meta name="description" content="虚拟机栈概述 虚拟机栈概述 虚拟机出现的背景 由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。 优点：跨平台，指令集小，编译器容易实现 缺点：性能下降，实现同样的功能需要更多的指令。 基本内容 Java虚拟机栈是什么? Java虚拟机栈(Java Virtual Machine Stack) ，早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧(Stack Frame) ，对应着一次次的Java方法调用。 是线程私有的 生命周期： 生命周期和线程一致。 作用： 主管Java程序的运行，它保存方法的局部变量、部分结果，并参与方法的调用和返回。">
    <style>
      html {
        background: #fff;
      }

      html[data-theme="dark"] {
        background: #1d1e1f;
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-6e69c84c.css" as="style"><link rel="stylesheet" href="/assets/style-6e69c84c.css">
    <link rel="modulepreload" href="/assets/app-86d02fc7.js"><link rel="modulepreload" href="/assets/04.虚拟机栈.html-fc356dcf.js"><link rel="modulepreload" href="/assets/04.虚拟机栈.html-f3dc20e8.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-9082bfed.js" as="script"><link rel="prefetch" href="/assets/intro.html-9646d3fc.js" as="script"><link rel="prefetch" href="/assets/slides.html-0e32a6bb.js" as="script"><link rel="prefetch" href="/assets/01.vuepress使用giscus评论插件.html-b8e90ab8.js" as="script"><link rel="prefetch" href="/assets/02.nginx 配置https访问云服务器.html-9e857031.js" as="script"><link rel="prefetch" href="/assets/01.go1.21新增日志库slog详解.html-7c2f213f.js" as="script"><link rel="prefetch" href="/assets/01.类加载子系统.html-677e61f6.js" as="script"><link rel="prefetch" href="/assets/02.运行时数据区概述及线程.html-5d108d13.js" as="script"><link rel="prefetch" href="/assets/03.程序计数器.html-fbd8d767.js" as="script"><link rel="prefetch" href="/assets/05.本地方法以及本地方法栈.html-ca570101.js" as="script"><link rel="prefetch" href="/assets/06.运行时数据区——堆.html-070d2479.js" as="script"><link rel="prefetch" href="/assets/07.方法区.html-0cd2abb1.js" as="script"><link rel="prefetch" href="/assets/08.垃圾回收概述.html-064ca77c.js" as="script"><link rel="prefetch" href="/assets/09.JVM相关参数.html-6c354de9.js" as="script"><link rel="prefetch" href="/assets/01.Grafana配置相关.html-9d4ec56c.js" as="script"><link rel="prefetch" href="/assets/02.容器技术概念.html-531d4387.js" as="script"><link rel="prefetch" href="/assets/03.Operator开发.html-e9734c92.js" as="script"><link rel="prefetch" href="/assets/04.k8s资源管理.html-64eb7894.js" as="script"><link rel="prefetch" href="/assets/05.admissionWebhook.html-8b752762.js" as="script"><link rel="prefetch" href="/assets/01.JAVA中的代理模式.html-22bb0555.js" as="script"><link rel="prefetch" href="/assets/01.检测远程服务是否开放.html-dc3df689.js" as="script"><link rel="prefetch" href="/assets/404.html-b7da1954.js" as="script"><link rel="prefetch" href="/assets/index.html-d39e5fd3.js" as="script"><link rel="prefetch" href="/assets/index.html-34f96424.js" as="script"><link rel="prefetch" href="/assets/index.html-57f644c8.js" as="script"><link rel="prefetch" href="/assets/index.html-87cf0acc.js" as="script"><link rel="prefetch" href="/assets/index.html-a494d414.js" as="script"><link rel="prefetch" href="/assets/index.html-1f7c57c2.js" as="script"><link rel="prefetch" href="/assets/index.html-f4a0ea5d.js" as="script"><link rel="prefetch" href="/assets/index.html-4a863479.js" as="script"><link rel="prefetch" href="/assets/index.html-3322a193.js" as="script"><link rel="prefetch" href="/assets/index.html-18c80985.js" as="script"><link rel="prefetch" href="/assets/index.html-46669ab1.js" as="script"><link rel="prefetch" href="/assets/index.html-0c6a99d9.js" as="script"><link rel="prefetch" href="/assets/index.html-4373569f.js" as="script"><link rel="prefetch" href="/assets/index.html-a560db41.js" as="script"><link rel="prefetch" href="/assets/index.html-636c9fbd.js" as="script"><link rel="prefetch" href="/assets/index.html-6d4b7d47.js" as="script"><link rel="prefetch" href="/assets/index.html-c1202dbf.js" as="script"><link rel="prefetch" href="/assets/index.html-8b68b68e.js" as="script"><link rel="prefetch" href="/assets/index.html-5461aa10.js" as="script"><link rel="prefetch" href="/assets/index.html-d1b69419.js" as="script"><link rel="prefetch" href="/assets/index.html-1e85a719.js" as="script"><link rel="prefetch" href="/assets/index.html-a5904a82.js" as="script"><link rel="prefetch" href="/assets/index.html-e8217846.js" as="script"><link rel="prefetch" href="/assets/index.html-4d3414cb.js" as="script"><link rel="prefetch" href="/assets/index.html-d0f97154.js" as="script"><link rel="prefetch" href="/assets/index.html-8cff9d00.js" as="script"><link rel="prefetch" href="/assets/index.html-e7971a37.js" as="script"><link rel="prefetch" href="/assets/index.html-5c5df507.js" as="script"><link rel="prefetch" href="/assets/index.html-8382d281.js" as="script"><link rel="prefetch" href="/assets/index.html-21d76e52.js" as="script"><link rel="prefetch" href="/assets/index.html-9302203e.js" as="script"><link rel="prefetch" href="/assets/index.html-57cb132f.js" as="script"><link rel="prefetch" href="/assets/intro.html-283297f9.js" as="script"><link rel="prefetch" href="/assets/slides.html-3b133012.js" as="script"><link rel="prefetch" href="/assets/01.vuepress使用giscus评论插件.html-3abd4416.js" as="script"><link rel="prefetch" href="/assets/02.nginx 配置https访问云服务器.html-4cbedada.js" as="script"><link rel="prefetch" href="/assets/01.go1.21新增日志库slog详解.html-c4ee0eba.js" as="script"><link rel="prefetch" href="/assets/01.类加载子系统.html-e44117f7.js" as="script"><link rel="prefetch" href="/assets/02.运行时数据区概述及线程.html-68711ac3.js" as="script"><link rel="prefetch" href="/assets/03.程序计数器.html-c518c87a.js" as="script"><link rel="prefetch" href="/assets/05.本地方法以及本地方法栈.html-35d95ef0.js" as="script"><link rel="prefetch" href="/assets/06.运行时数据区——堆.html-ece45bbd.js" as="script"><link rel="prefetch" href="/assets/07.方法区.html-89b30682.js" as="script"><link rel="prefetch" href="/assets/08.垃圾回收概述.html-dad5370e.js" as="script"><link rel="prefetch" href="/assets/09.JVM相关参数.html-7c6c626a.js" as="script"><link rel="prefetch" href="/assets/01.Grafana配置相关.html-d2556fef.js" as="script"><link rel="prefetch" href="/assets/02.容器技术概念.html-0e86120f.js" as="script"><link rel="prefetch" href="/assets/03.Operator开发.html-3b817038.js" as="script"><link rel="prefetch" href="/assets/04.k8s资源管理.html-e7711a9b.js" as="script"><link rel="prefetch" href="/assets/05.admissionWebhook.html-d5914dd9.js" as="script"><link rel="prefetch" href="/assets/01.JAVA中的代理模式.html-bf942c28.js" as="script"><link rel="prefetch" href="/assets/01.检测远程服务是否开放.html-f7651e3f.js" as="script"><link rel="prefetch" href="/assets/404.html-45bb8ed4.js" as="script"><link rel="prefetch" href="/assets/index.html-8cd3636d.js" as="script"><link rel="prefetch" href="/assets/index.html-3ed93978.js" as="script"><link rel="prefetch" href="/assets/index.html-d8fe40ea.js" as="script"><link rel="prefetch" href="/assets/index.html-6edb2ad7.js" as="script"><link rel="prefetch" href="/assets/index.html-02312245.js" as="script"><link rel="prefetch" href="/assets/index.html-c1b65115.js" as="script"><link rel="prefetch" href="/assets/index.html-e7d652d0.js" as="script"><link rel="prefetch" href="/assets/index.html-dbcd0202.js" as="script"><link rel="prefetch" href="/assets/index.html-5ffe17ca.js" as="script"><link rel="prefetch" href="/assets/index.html-0c830983.js" as="script"><link rel="prefetch" href="/assets/index.html-819c2f44.js" as="script"><link rel="prefetch" href="/assets/index.html-9d10c712.js" as="script"><link rel="prefetch" href="/assets/index.html-13666f5d.js" as="script"><link rel="prefetch" href="/assets/index.html-d3251239.js" as="script"><link rel="prefetch" href="/assets/index.html-ea83b191.js" as="script"><link rel="prefetch" href="/assets/index.html-a22cf8ca.js" as="script"><link rel="prefetch" href="/assets/index.html-4ba17cef.js" as="script"><link rel="prefetch" href="/assets/index.html-2bc94a26.js" as="script"><link rel="prefetch" href="/assets/index.html-d701baed.js" as="script"><link rel="prefetch" href="/assets/index.html-56c6fe48.js" as="script"><link rel="prefetch" href="/assets/index.html-906d67d2.js" as="script"><link rel="prefetch" href="/assets/index.html-154c2a61.js" as="script"><link rel="prefetch" href="/assets/index.html-57a8de6b.js" as="script"><link rel="prefetch" href="/assets/index.html-1e6bc4d9.js" as="script"><link rel="prefetch" href="/assets/index.html-734a6ea9.js" as="script"><link rel="prefetch" href="/assets/index.html-5f3b4844.js" as="script"><link rel="prefetch" href="/assets/index.html-6b014038.js" as="script"><link rel="prefetch" href="/assets/index.html-48b10ae4.js" as="script"><link rel="prefetch" href="/assets/index.html-6c049408.js" as="script"><link rel="prefetch" href="/assets/index.html-ac8f3140.js" as="script"><link rel="prefetch" href="/assets/index.html-ac38410f.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/assets/pageview-ec033769.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="飞哥与小佛"><!----><span class="vp-site-name hide-in-pad">飞哥与小佛</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="飞哥与小佛" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>飞哥与小佛<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="飞哥与小佛" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>飞哥与小佛<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Frontend</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Golang</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">2021</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="本地方法以及本地方法栈" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/05.%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88.html"><!---->本地方法以及本地方法栈<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="程序计数器" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/03.%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8.html"><!---->程序计数器<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="方法区" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/07.%E6%96%B9%E6%B3%95%E5%8C%BA.html"><!---->方法区<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="垃圾回收概述" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/08.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0.html"><!---->垃圾回收概述<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="类加载子系统" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/01.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F.html"><!---->类加载子系统<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="虚拟机栈" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html"><!---->虚拟机栈<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="虚拟机出现的背景" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#虚拟机出现的背景"><!---->虚拟机出现的背景<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="基本内容" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#基本内容"><!---->基本内容<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="栈中可能出现的异常" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#栈中可能出现的异常"><!---->栈中可能出现的异常<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="栈是运行时的单位，而堆是存储的单位。" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#栈是运行时的单位-而堆是存储的单位。"><!---->栈是运行时的单位，而堆是存储的单位。<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="设置虚拟机栈的大小" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#设置虚拟机栈的大小"><!---->设置虚拟机栈的大小<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="栈中存储什么？" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#栈中存储什么"><!---->栈中存储什么？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="栈运行原理" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#栈运行原理"><!---->栈运行原理<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Slot" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#slot"><!---->Slot<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="补充" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#补充"><!---->补充<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#问题"><!---->问题<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="虚方法和非虚方法" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#虚方法和非虚方法"><!---->虚方法和非虚方法<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="虚方法表" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/java/2021/04.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.html#虚方法表"><!---->虚方法表<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="运行时数据区——堆" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/06.%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E2%80%94%E2%80%94%E5%A0%86.html"><!---->运行时数据区——堆<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="运行时数据区概述及线程" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/02.%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%BA%BF%E7%A8%8B.html"><!---->运行时数据区概述及线程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="JVM相关参数" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/java/2021/09.JVM%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0.html"><!---->JVM相关参数<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">2022</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">K8s</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><!--[--><a aria-label="介绍页" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/intro.html"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>介绍页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->虚拟机栈</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/falser101" target="_blank" rel="noopener noreferrer">falser</a></span><span property="author" content="falser"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2021-02-12T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">java</span><!--]--><meta property="articleSection" content="java"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">jvm</span><!--]--><meta property="keywords" content="jvm"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#虚拟机出现的背景">虚拟机出现的背景</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#基本内容">基本内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#栈中可能出现的异常">栈中可能出现的异常</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#栈是运行时的单位-而堆是存储的单位。">栈是运行时的单位，而堆是存储的单位。</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#设置虚拟机栈的大小">设置虚拟机栈的大小</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#栈中存储什么">栈中存储什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#栈运行原理">栈运行原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#slot">Slot</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#补充">补充</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#问题">问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#虚方法和非虚方法">虚方法和非虚方法</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/#虚方法表">虚方法表</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><blockquote><p>虚拟机栈概述</p></blockquote><h1 id="虚拟机栈概述" tabindex="-1"><a class="header-anchor" href="#虚拟机栈概述" aria-hidden="true">#</a> 虚拟机栈概述</h1><h2 id="虚拟机出现的背景" tabindex="-1"><a class="header-anchor" href="#虚拟机出现的背景" aria-hidden="true">#</a> 虚拟机出现的背景</h2><p>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。 优点：跨平台，指令集小，编译器容易实现 缺点：性能下降，实现同样的功能需要更多的指令。</p><h2 id="基本内容" tabindex="-1"><a class="header-anchor" href="#基本内容" aria-hidden="true">#</a> 基本内容</h2><ul><li>Java虚拟机栈是什么? <ul><li>Java虚拟机栈(Java Virtual Machine Stack) ，早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧(Stack Frame) ，对应着一次次的Java方法调用。</li><li>是线程私有的</li></ul></li><li>生命周期： <ul><li>生命周期和线程一致。</li></ul></li><li>作用： <ul><li>主管Java程序的运行，它保存方法的局部变量、部分结果，并参与方法的调用和返回。</li></ul></li></ul><p><strong>优点</strong>：</p><ul><li>栈是一种快速有效的分配存储方式，访问速度仅次于程序计数器</li><li>对于栈来说不存在垃圾回收问题，存在OOM</li></ul><p>JVM直接对Java栈的操作只有两个: - 每个方法执行，伴随着进栈(入栈、压栈) - 执行结束后的出栈工作</p><h2 id="栈中可能出现的异常" tabindex="-1"><a class="header-anchor" href="#栈中可能出现的异常" aria-hidden="true">#</a> 栈中可能出现的异常</h2><p>Java虚拟机规范允许<strong>Java栈的大小是动态的或者是固定不变的</strong>。</p><ul><li>如果采用固定大小的Java虚拟机栈，那每一个线程的Java虚拟机栈容量可以在线程创建的时候独立选定。如果线程请求分配的栈容量超过Java虚拟机栈允许的最大容量，Java虚拟机将会抛出一个<code>StackOverflowError</code> 异常。</li><li>如果Java虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那Java虚拟机将会抛出一个<code>OutOfMemoryError</code> 异常。</li></ul><h2 id="栈是运行时的单位-而堆是存储的单位。" tabindex="-1"><a class="header-anchor" href="#栈是运行时的单位-而堆是存储的单位。" aria-hidden="true">#</a> 栈是运行时的单位，而堆是存储的单位。</h2><p>栈解决程序的运行问题，即程序如何执行，或者说如何处理数据。 堆解决的是数据存储的问题，即数据怎么放、放在哪儿。</p><h2 id="设置虚拟机栈的大小" tabindex="-1"><a class="header-anchor" href="#设置虚拟机栈的大小" aria-hidden="true">#</a> 设置虚拟机栈的大小</h2><p>-Xss256m</p><h1 id="栈的存储单位" tabindex="-1"><a class="header-anchor" href="#栈的存储单位" aria-hidden="true">#</a> 栈的存储单位</h1><h2 id="栈中存储什么" tabindex="-1"><a class="header-anchor" href="#栈中存储什么" aria-hidden="true">#</a> 栈中存储什么？</h2><ol><li>每个线程都有自己的栈，栈中的数据都是<strong>以栈帧(stack Frame) 的格式存在</strong>。</li><li>在这个线程上正在执行的每个方法都各自对应一个栈帧(Stack Frame) 。</li><li>栈帧是一个内存区块，是一个数据集，维系着方法执行过程中的各种数据信息。</li></ol><h2 id="栈运行原理" tabindex="-1"><a class="header-anchor" href="#栈运行原理" aria-hidden="true">#</a> 栈运行原理</h2><ol><li>JVM直接对Java栈的操作只有两个，就是对栈帧的<strong>压栈</strong>和<strong>出栈</strong>，遵循“先进后出”/“后进先出”原则。</li><li>在一条活动线程中，一个时间点上，只会有一个活动的栈帧。即只有当前正在执行的方法的栈帧(栈顶栈帧)是有效的，这个栈帧被称为<strong>当前栈帧</strong>(Current Frame) ，与当前栈帧相对应的方法就是<strong>当前方法</strong>(Current Method)，定义这个方法的类就是<strong>当前类</strong>(Current Class) 。</li><li>执行引擎运行的所有字节码指令只针对当前栈帧进行操作。</li><li>如果在该方法中调用了其他方法，对应的新的栈帧会被创建出来，放在栈的顶端，成为新的当前帧。</li><li>不同线程中所包含的栈帧是不允许存在相互引用的，即不可能在一个栈帧之中引用另外一个线程的栈帧。</li><li>如果当前方法调用了其他方法，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，接着，虚拟机会丢弃当前栈帧，使得前一个栈帧重新成为当前栈帧。</li><li>Java方法有两种返回函数的方式，一种是正常的函数返回，使用return指令;另外一种是抛出异常。不管使用哪种方式，都会导致栈帧被弹出。</li></ol><h1 id="栈帧内部结构" tabindex="-1"><a class="header-anchor" href="#栈帧内部结构" aria-hidden="true">#</a> 栈帧内部结构</h1><p>每个栈帧中存储着:</p><ol><li>局部变量表（Local variables)</li><li>操作数栈（operand stack）（或表达式栈）</li><li>动态链接(Dynamic Linking)（或指向运行时常量池的方法引用）</li><li>方法返回地址（Return Address）(或方法正常退出或者异常退出的定义)</li><li>一些附加信息 <img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/02/15/kuangstudy16b950bc-5b44-4d45-8320-ef999866882f.png" alt="结构" title="结构" loading="lazy"></li></ol><h1 id="局部变量表" tabindex="-1"><a class="header-anchor" href="#局部变量表" aria-hidden="true">#</a> 局部变量表</h1><ol><li>局部变量表也被称之为局部变量数组或本地变量表</li><li>定义为<strong>一个数字数组</strong>，主要用于<strong>存储方法参数和定义在方法体内的局部变量</strong>，这些数据类型包括各类基本数据类型、对象引用(reference） ，以及returnAddress类型。</li><li>由于局部变量表是建立在线程的栈上，是线程的<strong>私有数据</strong>，因此<strong>不存在数据安全问题</strong></li><li><strong>局部变量表所需的容量大小是在编译期确定下来的</strong>，并保存在方法的Code属性的maximum local variables数据项中。在方法运行期间是<strong>不会改变</strong>局部变量表的大小的。</li><li><strong>方法嵌套调用的次数由栈的大小决定</strong>。一般来说，<strong>栈越大，方法嵌套调用次数越多</strong>。对一个函数而言，它的参数和局部变量越多，使得局部变量表膨胀，它的栈帧就越大，以满足方法调用所需传递的信息增大的需求。进而函数调用就会占用更多的栈空间，导致其嵌套调用次数就会减少。</li><li><strong>局部变量表中的变量只在当前方法调用中有效</strong>。在方法执行时，虚拟机通过使用局部变量表完成参数值到参数变量列表的传递过程。<strong>当方法调用结束后，随着方法栈帧的销毁，局部变量表也会随之销毁</strong>。</li></ol><h2 id="slot" tabindex="-1"><a class="header-anchor" href="#slot" aria-hidden="true">#</a> Slot</h2><ol><li>参数值的存放总是在局部变量数组的index0开始，到数组长度-1的索引结束。</li><li>局部变量表，最基本的存储单元是Slot (变量槽)</li><li>局部变量表中存放编译期可知的各种基本数据类型(8种)，引用类型(reference)，returnAddress 类型的变量。</li><li>在局部变量表里，32位以内的类型只占用一个slot (包括returnAddress类型)，64位的类型(long和double)占用两个slot。 <ul><li>byte、short、char在存储前被转换为int, boolean也被转换为int，0表示false，非0表示true。</li><li>long和double则占据两个Slot。</li></ul></li><li>当一个实例方法被调用的时候，它的方法参数和方法体内部定义的局部变量将会按照顺序被复制到局部变量表中的每一个Slot上</li><li>如果当前帧是由<strong>构造方法或者实例方法</strong>创建的，那么该<strong>对象引用this</strong>将会存放在index为0的slot处，其余的参数按照参数表顺序继续排列。</li><li>如果需要访问局部变量表中一个64bit的局部变量值时，只需要使用前一个索引即可。(比如:访问long或double类型变量)</li><li>栈帧中的局部变量表中的槽位是可以重用的，如果一个局部变量过了其作用域，那么在其作用域之后申明的新的局部变量就很有可能会复用过期局部变量的槽位，从而达到节省资源的目的。</li></ol><h2 id="补充" tabindex="-1"><a class="header-anchor" href="#补充" aria-hidden="true">#</a> 补充</h2><ol><li>在栈帧中，与性能调优关系最为密切的部分就是前面提到的局部变量表。在方法执行时，虚拟机使用局部变量表完成方法的传递。</li><li>局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收。</li></ol><h1 id="操作数栈" tabindex="-1"><a class="header-anchor" href="#操作数栈" aria-hidden="true">#</a> 操作数栈</h1><ol><li>每一个独立的栈帧中除了包含局部变量表以外，还包含一个后进先出(Last-In-First-Out)的<strong>操作数栈</strong>，也可以称之为<strong>表达式栈</strong>(Expression Stack)。</li><li>操作数栈，在方法执行过程中，根据字节码指令，往栈中写入数据或提取数据，即入栈(push) /出栈(pop)。 <ul><li>某些字节码指令将值压入操作数栈，其余的字节码指令将操作数取出栈。使用它们后再把结果压入栈。</li><li>比如:执行复制、交换、求和等操作</li></ul></li><li>操作数栈，主要用于保存计算过程的中间结果，同时作为计算过程中变量临时的存储空间。</li><li>操作数栈就是JVM执行引擎的一个工作区，当一个方法刚开始执行的时候，一个新的栈帧也会随之被创建出来，这个方法的操作数栈是空的。</li><li>每一个操作数栈都会拥有一个明确的栈深度用于存储数值，其所需的最大深度在<strong>编译期就定义好了</strong>，保存在方法的Code属性中，为max_stack的值。</li><li>栈中的任何一个元素都是可以任意的Java数据类型。 <ul><li>32bit的类型占用<strong>一个栈</strong>单位深度</li><li>64bit的类型占用<strong>两个栈</strong>单位深度</li></ul></li><li>操作数栈<strong>并非采用访问索引的方式来进行数据访问</strong>的，而是只能通过标准的入栈(push)和出栈(pop)操作来完成一次数据访问。</li><li>如果被调用的方法带有返回值的话，其返回值将会被压入当前栈帧的操作数栈中，并更新PC寄存器中下一条需要执行的字节码指令。</li><li>操作数栈中元素的数据类型必须与字节码指令的序列严格匹配，这由编译器在编译器期间进行验证，同时在类加载过程中的类检验阶段的数据流分析阶段要再次验证。</li><li>另外，我们说Java虚拟机的<strong>解释引擎是基于栈的执行引擎</strong>，其中的栈指的就是操作数栈。</li></ol><h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题" aria-hidden="true">#</a> 问题</h2><p>i++ 和 ++i的区别？ i++ 先赋值再+1，++i 先+1再赋值</p><h1 id="栈顶缓存技术" tabindex="-1"><a class="header-anchor" href="#栈顶缓存技术" aria-hidden="true">#</a> 栈顶缓存技术</h1><h1 id="动态链接-指向运行时常量池的方法引用" tabindex="-1"><a class="header-anchor" href="#动态链接-指向运行时常量池的方法引用" aria-hidden="true">#</a> 动态链接（指向运行时常量池的方法引用）</h1><ol><li>每一个栈帧内部都包含一个指向<strong>运行时常量池</strong>中<strong>该栈帧所属方法的引用</strong>。包含这个引用的目的就是为了支持当前方法的代码能够<strong>实现动态链接</strong>（Dynamic Linking） 。比如： invokedynamic指令</li><li>在Java源文件被编译到字节码文件中时，所有的变量和方法引用都作为符号引用（Symbolic Reference）保存在class文件的常量池里。比如：描述一个方法调用了另外的其他方法时，就是通过常量池中指向方法的符号引用来表示的，那么<strong>动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用。</strong></li></ol><figure><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/02/17/kuangstudyacdd449e-b6e1-4748-9cf5-9f1a27e8c054.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="方法的调用-解析与分派" tabindex="-1"><a class="header-anchor" href="#方法的调用-解析与分派" aria-hidden="true">#</a> 方法的调用:解析与分派</h1><p>在JVM中，将符号引用转换为调用方法的直接引用与方法的绑定机制相关。</p><ul><li>静态链接： 当一个字节码文件被装载进JVM内部时，如果被调用的<strong>目标方法在编译期可知</strong>，且运行期保持不变时。这种情况下将调用方法的符号引用转换为直接引用的过程称之为静态链接。</li><li>动态链接： 如果被<strong>调用的方法在编译期无法被确定下来</strong>，也就是说，只能够在程序运行期将调用方法的符号引用转换为直接引用，由于这种引用转换过程具备动态性，因此也就被称之为动态链接。</li></ul><p>对应的方法的绑定机制为：早期绑定（Early Binding）和晚期绑定（Late Binding） 。绑定是<strong>一个字段、方法或者类在符号引用被替换为直接引用的过程，这仅仅发生一次。</strong></p><ul><li>早期绑定： 早期绑定就是指被调用的目标方法如果在<strong>编译期可知，且运行期保持不变时</strong>，即可将这个方法与所属的类型进行绑定，这样一来，由于明确了被调用的目标方法究竟是哪一个，因此也就可以使用静态链接的方式将符号引用转换为直接引用。</li><li>晚期绑定： 如果被调用的方法在<strong>编译期无法被确定下来，只能够在程序运行期根据实际的类型绑定</strong>相关的方法，这种绑定方式也就被称之为晚期绑定。</li></ul><h2 id="虚方法和非虚方法" tabindex="-1"><a class="header-anchor" href="#虚方法和非虚方法" aria-hidden="true">#</a> 虚方法和非虚方法</h2><p>虚拟机中提供了以下几条方法调用指令：</p><ul><li>普通调用指令： <ol><li>invokestatic：调用静态方法，解析阶段确定唯一方法版本</li><li>invokespecial：调用init()方法，私有及父类方法，解析阶段确定唯一方法版本</li><li>invokevirtual：调用所有虚方法</li><li>invokeinterface：调用接口方法</li></ol></li><li>动态调用指令： <ol><li>invokedynamic：动态解析出需要调用的方法，然后执行</li></ol></li></ul><p>前四条指令固化在虚拟机内部，方法的调用执行不可人为干预，而invokedynamic指令则支持由用户确定方法版本。<strong>其中invokestatic指令和invokespecial指令调用的方法称为非虚方法</strong>，<strong>其余的（final修饰的除外）称为虚方法。</strong></p><h2 id="虚方法表" tabindex="-1"><a class="header-anchor" href="#虚方法表" aria-hidden="true">#</a> 虚方法表</h2><p>在面向对象的编程中，会很频繁的使用到动态分派，如果在每次动态分派的过程中都要重新在类的方法元数据中搜索合适的目标的话就可能影响到执行效率。因此，为了提高性能， JVM采用在<strong>类的方法区建立一个虚方法表</strong>（virtual method table） （<strong>非虚方法不会出现在表中</strong>）来实现。使用<strong>索引表来代替查找</strong>。 每个类中都有一个虚方法表，表中存放着各个方法的实际入口。 那么虚方法表什么时候被创建？ 虚方法表会在<strong>类加载的链接阶段被创建并开始初始化</strong>，类的变量初始值准备完成之后， JVM会把该类的方法表也初始化完毕。</p><h1 id="方法返回地址" tabindex="-1"><a class="header-anchor" href="#方法返回地址" aria-hidden="true">#</a> 方法返回地址</h1><ol><li><p>存放调用该方法的pc寄存器的值。</p></li><li><p>一个方法的结束，有两种方式: ➢正常执行完成 ➢出现未处理的异常，非正常退出</p></li><li><p>无论通过哪种方式退出，在方法退出后都返回到该方法被调用的位置。方法正常退出时，调用者的pc计数器的值作为返回地址，即调用该方法的指令的下一条指令的地址。而通过异常退出的，返回地址是要通过异常表来确定，栈帧中一般不会保存这部分信息。</p></li></ol><p>当一个方法开始执行后，只有<strong>两种方式</strong>可以退出这个方法:</p><ol><li>执行引擎遇到任意一个方法返回的字节码指令(return)，会有返回值传递给，上层的方法调用者，简称正常完成出口; ➢一个方法在正常调用完成之后究竟需要使用哪一个返回指令还需要<strong>根据方法返回值的实际数据类型</strong>而定。 ➢在字节码指令中，返回指令包含<strong>ireturn</strong> (当返回值是boolean、 byte、char.short和int类型时使用)、lreturn、 freturn、 dreturn以及areturn，另外还有一个return指令供声明为void的方法、实例初始化方法、类和接0的初始化方法使用。</li><li>在方法执行的过程中遇到了<strong>异常(Exception) <strong>，并且这个异常</strong>没有在方法内进行处理</strong>，也就是只要在本方法的异常表中没有搜索到匹配的异常处理器，就会导致方法退出。简称<strong>异常完成出口</strong>。方法执行过程中抛出异常时的异常处理，存储在一个 异常处理表，方便在发生异常的时候找到处理异常的代码。 <img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/02/19/kuangstudyf5ea3e3d-c56d-4344-b9e1-90b88068bc85.jpg" alt="异常表" title="异常表" loading="lazy"></li></ol><h1 id="一些附加信息" tabindex="-1"><a class="header-anchor" href="#一些附加信息" aria-hidden="true">#</a> 一些附加信息</h1><p>栈帧中还允许携带与Java虛拟机实现相关的一些附加信息。例如 对程序调试提供支持的信息。</p><h1 id="栈的相关面试题" tabindex="-1"><a class="header-anchor" href="#栈的相关面试题" aria-hidden="true">#</a> 栈的相关面试题</h1><ol><li>举例栈溢出的情况? (StackOverflowError) 通过-Xss设置栈的大小，如果申请不到内存时，内存溢出OOM</li><li>调整栈大小，就能保证不出现溢出吗? 不能</li><li>分配的栈内存越大越好吗? 不是，整个内存是有限的，可能会造成可用线程数减少</li><li>垃圾回收是否会涉及到虚拟机栈? 不会</li><li>方法中定义的局部变量是否线程安全?</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//s1的声明方式是线程安全的</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//StringBuilder:线程不安全</span>
	<span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//sBuilder的操作过程:是线程不安全的</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> sBuilder<span class="token punctuation">)</span><span class="token punctuation">{</span>
	sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//s1的操作:是线程不安全的</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StringBuilder</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> s1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//s1的操作:是线程安全的</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/posts/java/2021/04.虚拟机栈.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zhangjf@tongtech.com">T2816</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="类加载子系统" class="vp-link nav-link prev nav-link prev" href="/posts/java/2021/01.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->类加载子系统</div></a><a aria-label="运行时数据区——堆" class="vp-link nav-link next nav-link next" href="/posts/java/2021/06.%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E2%80%94%E2%80%94%E5%A0%86.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">运行时数据区——堆<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2023 falser</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-86d02fc7.js" defer></script>
  </body>
</html>
